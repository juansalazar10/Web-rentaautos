<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin Dashboard - RentaAutos</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Admin dashboard styles -->
    <link rel="stylesheet" href="../css/admin-dashboard.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
      <div class="container">
        <a class="navbar-brand" href="/">RentaAutos — Admin</a>
        <div class="ms-auto">
          <button id="btnLogout" class="btn btn-outline-light">
            Cerrar sesión
          </button>
        </div>
      </div>
    </nav>

    <main class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">Panel de administración</h1>
        <small id="adminInfo" class="text-muted"></small>
      </div>

      <section class="mb-4">
        <h2 class="h5">Usuarios</h2>
        <p class="text-muted">
          Lista de usuarios registrados (solo lectura en esta versión).
        </p>
        <div id="usersList">Cargando usuarios...</div>
      </section>

      <section>
        <h2 class="h5">Acciones rápidas</h2>
        <div class="row g-3">
          <div class="col-md-4">
            <div class="card p-3">
              <h6>Exportar usuarios</h6>
              <p class="small text-muted">Descargar CSV de usuarios.</p>
              <button
                id="btnExportUsers"
                class="btn btn-sm btn-outline-success"
              >
                Exportar
              </button>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card p-3">
              <h6>Reservas</h6>
              <p class="small text-muted">Revisar reservas recientes.</p>
              <a
                href="/pages/dashboard.html"
                class="btn btn-sm btn-outline-success"
                >Ver reservas</a
              >
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      (function () {
        const auth = JSON.parse(sessionStorage.getItem("auth") || "null");
        if (!auth || !auth.user || auth.user.rol !== "admin") {
          window.location.href = "/";
          return;
        }

        document.getElementById(
          "adminInfo"
        ).innerText = `${auth.user.nombre} · ${auth.user.email}`;

        const usersList = document.getElementById("usersList");
        fetch("/api/usuarios", {
          headers: { Authorization: "Bearer " + auth.token },
        })
          .then((r) => r.json())
          .then((rows) => {
            if (!Array.isArray(rows) || !rows.length)
              return (usersList.innerHTML =
                '<p class="text-muted">No hay usuarios.</p>');
            const table = document.createElement("table");
            table.className = "table table-bordered";
            table.innerHTML =
              "<thead><tr><th>ID</th><th>Nombre</th><th>Email</th><th>Fecha registro</th></tr></thead>" +
              "<tbody>" +
              rows
                .map(
                  (u) =>
                    `<tr><td>${u.id}</td><td>${u.nombre}</td><td>${u.email}</td><td>${u.fecha_registro}</td></tr>`
                )
                .join("") +
              "</tbody>";
            usersList.innerHTML = "";
            usersList.appendChild(table);
          })
          .catch((err) => {
            console.error(err);
            usersList.innerHTML =
              '<p class="text-danger">Error cargando usuarios.</p>';
          });

        document.getElementById("btnLogout").addEventListener("click", () => {
          sessionStorage.removeItem("auth");
          window.location.href = "/";
        });

        document
          .getElementById("btnExportUsers")
          .addEventListener("click", () => {
            alert("Funcionalidad de exportar pendiente de implementar.");
          });
      })();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
